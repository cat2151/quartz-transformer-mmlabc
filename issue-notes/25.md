# issue 五線譜表示の横幅が大きすぎて少しはみ出す。横幅を調整する方法を検討する #25
[issues #25](https://github.com/cat2151/quartz-transformer-mmlabc/issues/25)

## 問題
五線譜表示の横幅が固定値600pxに設定されており、狭いコンテナや画面では五線譜がはみ出してしまう問題がありました。

## 解決策
コンテナの幅を動的に取得し、それに応じてstaffwidthを計算するように変更しました。

### 実装の詳細
1. **動的幅計算**: `element.offsetWidth` または `element.clientWidth` を使用してコンテナの実際の幅を取得
2. **パディング調整**: コンテナ幅から40pxを引いて、パディング（左右各1em）と安全マージンを確保
3. **幅の制限**: 
   - 最小幅: 300px（小さすぎて読めなくなることを防ぐ）
   - 最大幅: 800px（大きすぎて見づらくなることを防ぐ）

### 変更したファイル
- `src/index.ts`: メインプラグイン実装のインラインJavaScript
- `demo.html`: デモページの対応するスクリプト

### コード例
```javascript
// Calculate responsive staff width based on container
const containerWidth = element.offsetWidth || element.clientWidth || 600;
// Subtract padding (1em on each side) plus safety margin
// Assuming typical font-size: 1em ≈ 16px, so 2em + margin ≈ 40px
const availableWidth = containerWidth - 40;
// Set reasonable min/max bounds
const staffWidth = Math.min(Math.max(availableWidth, 300), 800);

// Render with calculated width
const visualObj = ABCJS.renderAbc(element, abcNotation, {
  responsive: 'resize',
  staffwidth: staffWidth,
  scale: 1.0
});
```

## テスト結果
- 既存のテスト38個全てパス
- セキュリティチェック: 問題なし
- コードレビュー: 完了（コメントの改善も実施）

## 効果
- 狭いコンテナでも五線譜がはみ出さずに表示される
- レスポンシブデザインに対応
- モバイル画面でも適切に表示される
- 既存の機能に影響なし

