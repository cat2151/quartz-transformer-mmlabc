# issue å·¦ãƒšã‚¤ãƒ³ã‹ã‚‰è‡ªåˆ†è‡ªèº«ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ãªãŠã™ã¨äº”ç·šè­œãŒæ¶ˆãˆã¦ã—ã¾ã†ã—ã€ãã®ã¨ãconsoleã«ã¯ä½•ã‚‚å‡ºåŠ›ã•ã‚Œãªã„ï¼ˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ¤œçŸ¥ã§ãã¦ã„ãªã„ï¼‰ #71
[issues #71](https://github.com/cat2151/quartz-transformer-mmlabc/issues/71)

# è£œè¶³æƒ…å ±
- ã“ã®ã¨ãã€ç”»é¢å³ä¸Šã®graph viewã®è¡¨ç¤ºã¯åˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹
- ãªã®ã§SPAãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è‡ªä½“ã¯è¡Œã‚ã‚Œã¦ã„ã‚‹ã€ã¨åˆ¤æ–­ã™ã‚‹
- ãã®æ¤œçŸ¥ãŒã§ãã¦ã„ãªã„ã€ã¨åˆ¤æ–­ã™ã‚‹

# ãƒ–ãƒ¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒŸãƒ³ã‚°
- å…¬å¼ã¯ã©ã†ã‚„ã£ã¦ã„ã‚‹ã®ã‹ã€ã“ã“ã®README.ja.mdç­‰ã«ãƒã‚¦ãƒã‚¦ã‚’ã¾ã¨ã‚ãŸã»ã†ãŒã„ã„ã€‚agentã«ã‚„ã‚‰ã›ã‚‹ã¤ã‚‚ã‚Š
  - ãªãœãªã‚‰ã€Œä»Šã®å®Ÿè£…ã¯ã€ã“ã®ã‚ˆã†ãªæ ¹æœ¬çš„ãªä¸å…·åˆãŒã‚ã‚‹ã®ã§ã€ãŠãã‚‰ãæ–¹æ³•ã«èª¤ã‚ŠãŒã‚ã‚Šã€æ­£ã§ã¯ãªã„ã€ã¨åˆ¤æ–­ã™ã‚‹ã‹ã‚‰
  - ä»¥å‰èª­ã¾ã›ãŸã‘ã©ã“ã†ã‚„ã£ã¦å¤±æ•—ã—ã¦ã„ã‚‹ã€‚ç„¡è¦–ã—ã¦ã„ã‚‹ã®ã‹ã‚‚ã—ã‚Œãªã„ã€‚ãã‚Œã‚‚å«ã‚ã¦æ•´ç†ãŒã‚ˆã•ãã†
  - ç†æƒ³ã¯ã€ŒåŒã˜ç”¨é€”ã§ã€å®Ÿéš›ã«å‹•ãã‚‚ã®ã€ãŒè¦‹ã¤ã‹ã‚‹ã“ã¨ã ãŒã€è¦‹ã¤ã‹ã£ã¦ã„ãªã„ã€‚ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«è¨˜äº‹ï¼ˆå‹•ãã‚‚ã®ã¯ãªã„ï¼‰ã ã¨ã“ã†ã„ã†ã¨ãã«ã¯ä¸è¶³ã§ã‚ã‚‹ã€ã¨åˆ¤æ–­ã™ã‚‹
- agentã¯æ¯å›TypeScriptã‚³ãƒ¼ãƒ‰ã‚’JavaScriptéƒ¨åˆ†ã«æ›¸ã„ã¦ç ´å£Šã—ã¦ã„ã‚‹ã®ã§ã€AGENTS.mdç³»ã«æ›¸ã„ã¦ãŠãã¾ã—ã‚‡ã†

# å…¬å¼
- https://quartz.jzhao.xyz/advanced/creating-components

# nav
- ä»¥ä¸‹ã¯å·¦ãƒšã‚¤ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã§ã‚‚ç¢ºå®Ÿã«logãŒå‡ºãŸ
```
document.addEventListener("nav", () => {
  console.log("ğŸ”¥ nav fired", location.pathname)
})
```
- ã“ã‚Œã‚‚åŒã˜ãã€å·¦ãƒšã‚¤ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã§ã‚‚ç¢ºå®Ÿã«logãŒå‡ºãŸ
```
(() => {
  const orig = EventTarget.prototype.dispatchEvent;
  EventTarget.prototype.dispatchEvent = function (event) {
    if (event?.type === "nav") {
      console.log("ğŸš¨ nav DISPATCHED", event, "on", this);
      console.trace();
    }
    return orig.call(this, event);
  };
  console.log("dispatchEvent patched");
})();
```
çµæœã¯
```
ğŸš¨ nav DISPATCHED CustomEventÂ {isTrusted: false, detail: {â€¦}, type: 'nav', target: null, currentTarget: null,Â â€¦} on #document (https://cat2151.github.io/digital-garden/Quartz-%E3%82%B3%E3%83%BC%E3%83%89%E9%80%B2%E8%A1%8C%E3%82%92%E4%BA%94%E7%B7%9A%E8%AD%9C%E3%81%A7%E8%A1%A8%E7%A4%BA%E3%81%97%E3%81%A6%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E3%81%A7%E6%BC%94%E5%A5%8F%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%97%E3%81%9F)
VM1879:6 console.trace
EventTarget.dispatchEvent @ VM1879:6
qr @ postscript.js:1199
li @ postscript.js:1199
await in li
Rr @ postscript.js:1199
ï¼ˆåŒ¿åï¼‰ @ postscript.js:1199
```
# ãƒ–ãƒ©ã‚¦ã‚¶consoleã ã‘ã§ã¯å¾©æ´»ã›ãš
ã‚„ã£ãŸã“ã¨
```
// ã¾ãšé–¢æ•°ãŒè¦‹ãˆã‚‹ã‹ç¢ºèª
Object.keys(window).filter(k => k.includes("initialize"))
```
- è¦‹ãˆãªã„ã€‚inité–¢æ•°ã¯ IIFE ã®ä¸­ã«é–‰ã˜è¾¼ã‚ã‚‰ã‚Œã¦ã„ã¦ console ã‹ã‚‰è§¦ã‚Œãªã„

- ãã—ã¦ä»¥ä¸‹ã‚’å®Ÿè¡Œ
```
document.addEventListener("nav", () => {
  console.log("ğŸ§ª console nav hook");

  // 1. abcjs ãŒè§¦ã‚Œã‚‹ DOM ã‚’å¼·åˆ¶ãƒªã‚»ãƒƒãƒˆ
  document.querySelectorAll(".abc-notation").forEach(el => {
    // SVG ã‚’æ¶ˆã™
    el.innerHTML = "";
  });

  // 2. Quartz ã®æ—¢å­˜ nav å‡¦ç†ã‚’ã‚‚ã†ä¸€åº¦èµ°ã‚‰ã›ã‚‹
  setTimeout(() => {
    console.log("ğŸ§ª forcing mutation");
    document.body.appendChild(document.createComment("force-rerender"));
  }, 0);
});
```
- çµæœã€å·¦ãƒšã‚¤ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€äº”ç·šè­œã¯æ¶ˆãˆã¦ã€ä¸Šè¨˜logã¯å‡ºåŠ›ã•ã‚ŒãŸ

# ãƒ‡ãƒãƒƒã‚°loggerã‚’TypeScriptå´ã«æ›¸ã„ã¦ã€å•é¡Œã‚’å¯è¦–åŒ–ã‚’ã™ã‚‹
```
  // ===== nav ãƒ‡ãƒãƒƒã‚°å¯è¦–åŒ– =====

  function logNavDebug(where) {
    return function (e) {
      const ce = e

      const abcNodes = document.querySelectorAll('.abc-notation')
      const processed = document.querySelectorAll('[data-mmlabc-processed]')

      console.groupCollapsed('[nav @ ' + where + ']')

      console.log('event:', e)
      console.log('detail:', ce && ce.detail)
      console.log('target:', e.target)
      console.log('currentTarget:', e.currentTarget)

      console.log('abc-notation count:', abcNodes.length)
      console.log('processed count:', processed.length)

      if (abcNodes.length > 0) {
        const el = abcNodes[0]
        console.log('sample abc element:', el)
        console.log(
          'sample processed?',
          el.hasAttribute('data-mmlabc-processed')
        )
      }

      console.groupEnd()
    }
  }

  // capture â†’ bubble â†’ window
  document.addEventListener('nav', logNavDebug('document-capture'), true)
  document.addEventListener('nav', logNavDebug('document'))
  window.addEventListener('nav', logNavDebug('window'))

  // ===== ä»¥ä¸Šã€nav ãƒ‡ãƒãƒƒã‚°å¯è¦–åŒ– =====
```
- å·¦ãƒšã‚¤ãƒ³ã®äº”ç·šè­œpageã‚’ã‚¯ãƒªãƒƒã‚¯
- çµæœã€äº”ç·šè­œãŒæ¶ˆãˆã¦ã€ä»¥ä¸‹ã®logãŒå‡ºåŠ›ã•ã‚ŒãŸ
```
[MML-ABC-Transformer] ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ¤œçŸ¥ã—ã¾ã—ãŸã€‚ã‚½ãƒ¼ã‚¹: MutationObserver
VM66:116 [MML-ABC-Transformer] äº”ç·šè­œè¡¨ç¤ºå‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™
VM66:125 [MML-ABC-Transformer] å‡¦ç†å¯¾è±¡ã®æ¥½è­œãƒ–ãƒ­ãƒƒã‚¯æ•°: 6
3VM66:130 [MML-ABC-Transformer] ã‚¹ã‚­ãƒƒãƒ—: æ—¢ã«å‡¦ç†æ¸ˆã¿ã®è¦ç´ 
VM66:136 [MML-ABC-Transformer] æ–°ã—ã„æ¥½è­œè¦ç´ ã‚’å‡¦ç†ã—ã¾ã™ã€‚Type: chord
VM66:136 [MML-ABC-Transformer] æ–°ã—ã„æ¥½è­œè¦ç´ ã‚’å‡¦ç†ã—ã¾ã™ã€‚Type: mml
VM66:136 [MML-ABC-Transformer] æ–°ã—ã„æ¥½è­œè¦ç´ ã‚’å‡¦ç†ã—ã¾ã™ã€‚Type: abc
VM66:346 [MML-ABC-Transformer] äº”ç·šè­œè¡¨ç¤ºå‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸã€‚å‡¦ç†æ™‚é–“: 8.70 ms
VM66:84 [nav @ document-capture]
VM66:86 event: CustomEventÂ {isTrusted: false, detail: {â€¦}, type: 'nav', target: document, currentTarget: document,Â â€¦}
VM66:87 detail: {url: 'Quartz-ã‚³ãƒ¼ãƒ‰é€²è¡Œã‚’äº”ç·šè­œã§è¡¨ç¤ºã—ã¦ã‚¯ãƒªãƒƒã‚¯ã§æ¼”å¥ã§ãã‚‹ã‚ˆã†ã«ã—ãŸ'}
VM66:88 target: #document (https://cat2151.github.io/digital-garden/Quartz-%E3%82%B3%E3%83%BC%E3%83%89%E9%80%B2%E8%A1%8C%E3%82%92%E4%BA%94%E7%B7%9A%E8%AD%9C%E3%81%A7%E8%A1%A8%E7%A4%BA%E3%81%97%E3%81%A6%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E3%81%A7%E6%BC%94%E5%A5%8F%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%97%E3%81%9F)
VM66:89 currentTarget: #document (https://cat2151.github.io/digital-garden/Quartz-%E3%82%B3%E3%83%BC%E3%83%89%E9%80%B2%E8%A1%8C%E3%82%92%E4%BA%94%E7%B7%9A%E8%AD%9C%E3%81%A7%E8%A1%A8%E7%A4%BA%E3%81%97%E3%81%A6%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E3%81%A7%E6%BC%94%E5%A5%8F%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%97%E3%81%9F)
VM66:91 abc-notation count: 3
VM66:92 processed count: 0
VM66:96 sample abc element: <div class=â€‹"abc-notation chord-block" data-chord=â€‹"C Dm7 G7^2, CM7" data-type=â€‹"chord" role=â€‹"button" tabindex=â€‹"0" aria-label=â€‹"Play music notation">â€‹</div>â€‹
VM66:97 sample processed? false
VM66:84 [nav @ document]
VM66:86 event: CustomEventÂ {isTrusted: false, detail: {â€¦}, type: 'nav', target: document, currentTarget: document,Â â€¦}
VM66:87 detail: {url: 'Quartz-ã‚³ãƒ¼ãƒ‰é€²è¡Œã‚’äº”ç·šè­œã§è¡¨ç¤ºã—ã¦ã‚¯ãƒªãƒƒã‚¯ã§æ¼”å¥ã§ãã‚‹ã‚ˆã†ã«ã—ãŸ'}
VM66:88 target: #document (https://cat2151.github.io/digital-garden/Quartz-%E3%82%B3%E3%83%BC%E3%83%89%E9%80%B2%E8%A1%8C%E3%82%92%E4%BA%94%E7%B7%9A%E8%AD%9C%E3%81%A7%E8%A1%A8%E7%A4%BA%E3%81%97%E3%81%A6%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E3%81%A7%E6%BC%94%E5%A5%8F%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%97%E3%81%9F)
VM66:89 currentTarget: #document (https://cat2151.github.io/digital-garden/Quartz-%E3%82%B3%E3%83%BC%E3%83%89%E9%80%B2%E8%A1%8C%E3%82%92%E4%BA%94%E7%B7%9A%E8%AD%9C%E3%81%A7%E8%A1%A8%E7%A4%BA%E3%81%97%E3%81%A6%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E3%81%A7%E6%BC%94%E5%A5%8F%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%97%E3%81%9F)
VM66:91 abc-notation count: 3
VM66:92 processed count: 0
VM66:96 sample abc element: <div class=â€‹"abc-notation chord-block" data-chord=â€‹"C Dm7 G7^2, CM7" data-type=â€‹"chord" role=â€‹"button" tabindex=â€‹"0" aria-label=â€‹"Play music notation">â€‹</div>â€‹
VM66:97 sample processed? false
```
# ã©ã†ã™ã‚‹ï¼Ÿ
- LLMã«ã‚½ãƒ¼ã‚¹ã¨ä¸Šè¨˜ï¼ˆissueå‰åŠã¯æŠ•ã’ãªãã¦ã„ã„æƒ³å®šï¼‰ã‚’æŠ•ã’ã‚‹ or agent
